<?xml version="1.0" ?>
<psalm
  errorLevel="5"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xmlns="https://getpsalm.org/schema/config"
  xsi:schemaLocation="https://getpsalm.org/schema/config vendor/vimeo/psalm/config.xsd"
  phpVersion="8.2"
  noCache="false"
  findUnusedPsalmSuppress="true"
  skipChecksOnUnresolvableIncludes="true"
  allowPhpStormGenerics="true"
  allowStringToStandInForClass="true"
  memoizeMethodCallResults="true"
  hoistConstants="true"
  addParamTypehint="false"
  checkForThrowsDocblock="false"
  checkForThrowsInGlobalScope="false"
  sealAllMethods="false"
  sealAllProperties="false"
>
  <projectFiles>
    <directory name="src" />
    <directory name="examples" />
    <directory name="config" />
    <directory name="tests" />
    <ignoreFiles>
      <directory name="vendor" />
      <directory name="src/Laravel" />
    </ignoreFiles>
  </projectFiles>

  <plugins>
    <pluginClass class="Psalm\PhpUnitPlugin\Plugin" />
  </plugins>

  <issueHandlers>
    <!-- Laravel function compatibility -->
    <UndefinedFunction>
      <errorLevel type="suppress">
        <referencedFunction name="config" />
        <referencedFunction name="app" />
        <referencedFunction name="now" />
        <referencedFunction name="config_path" />
        <referencedFunction name="env" />
      </errorLevel>
    </UndefinedFunction>

    <!-- Complex return type issues in GdprProcessor -->
    <InvalidReturnType>
      <errorLevel type="suppress">
        <file name="src/GdprProcessor.php" />
      </errorLevel>
    </InvalidReturnType>

    <!-- Override attributes - suppress for now to avoid breaking changes -->
    <MissingOverrideAttribute errorLevel="suppress" />

    <!-- Mixed types - necessary for flexible APIs -->
    <MixedArgument errorLevel="suppress" />
    <MixedAssignment errorLevel="suppress" />
    <MixedMethodCall errorLevel="suppress" />
    <MixedPropertyFetch errorLevel="suppress" />
    <MixedArrayAccess errorLevel="suppress" />

    <!-- Missing type annotations - backward compatibility -->
    <MissingReturnType errorLevel="suppress" />
    <MissingParamType errorLevel="suppress" />
    <MissingPropertyType errorLevel="suppress" />

    <!-- Prevent Psalm from adding complex nested return types -->
    <MismatchingDocblockReturnType errorLevel="suppress" />
    <MoreSpecificReturnType errorLevel="suppress" />
    <LessSpecificReturnStatement errorLevel="suppress" />

    <!-- Test-specific suppressions -->

    <!-- Test validation issues -->
    <InvalidArgument>
      <errorLevel type="suppress">
        <directory name="tests" />
      </errorLevel>
    </InvalidArgument>

    <!-- Test function calls -->
    <UndefinedFunction>
      <errorLevel type="suppress">
        <directory name="tests" />
      </errorLevel>
    </UndefinedFunction>

    <!-- Test utility calls -->
    <UnusedFunctionCall>
      <errorLevel type="suppress">
        <directory name="tests" />
      </errorLevel>
    </UnusedFunctionCall>

    <!-- Laravel-specific patterns -->
    <!-- (Laravel directory is excluded from scanning) -->

    <!-- Intentional design choices -->
    <PropertyNotSetInConstructor errorLevel="suppress" />
    <PossiblyUnusedMethod errorLevel="suppress" />
    <PossiblyUnusedProperty errorLevel="suppress" />

    <!-- Array access patterns for configuration -->
    <PossiblyUndefinedArrayOffset errorLevel="suppress" />
    <PossiblyInvalidArrayOffset errorLevel="suppress" />

    <!-- Closure patterns in callbacks -->
    <UnusedClosureParam errorLevel="suppress" />
    <MissingClosureParamType errorLevel="suppress" />
    <MissingClosureReturnType errorLevel="suppress" />

    <!-- String manipulation patterns -->
    <PossiblyInvalidCast errorLevel="suppress" />
  </issueHandlers>
</psalm>
